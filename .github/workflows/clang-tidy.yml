name: clang-tidy

on:
  push:
  pull_request:

jobs:
  tidy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install ninja
        run: sudo apt-get update && sudo apt-get install -y ninja-build

      # The installs llvm and then exports LLVM_PATH
      - name: Install LLVM/Clang
        uses: KyleMayes/install-llvm-action@v2
        with:
          version: 19

      - name: Put LLVM on PATH
        run: echo "$LLVM_PATH/bin" >> "$GITHUB_PATH"

      - name: Setup vcpkg (manifest mode with cache)
        uses: lukka/run-vcpkg@v11

      - name: CMake configure
        uses: lukka/run-cmake@v10
        with:
          configurePreset: 'debug'

      - name: Run clang-tidy (full project)
        run: |
          # Fail on any tidy warning; keep logs clean; avoid formatting side-effects.
          run-clang-tidy \
            -quiet \
            -use-color=false \
            -p build/debug \
            -j "$(nproc)" \
            -warnings-as-errors='*'

